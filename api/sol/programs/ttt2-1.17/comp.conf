# designed for the 2016 competition

# hack to get differences between full/certified strategy
# abbreviation is set using "-cpf" flag when calling ttt2
#FULL=      #use for full version
#FULL=fail; #use for certified version

PRETRSTO=5
PRESRSTO=20
SCCTOTRS=25
SCCTOXTRS=29
TOTRS=29
SCCTOSRS=29
TOSRS=29
TOSXTH=5
TOFRTH=8
TOTHRD=10
TOHALF=15
TO=29

#CeTA does not support -rfc and -qc
BOUNDS = (bounds -cert || FULL(bounds -rfc -qc))
#Ceta does not support -dp and -rfc -qc
BOUNDSDPSRS = (FULL((bounds -dp -rfc -qc[TOTHRD] | bounds -dp -rfc -all -qc)[TOHALF] || bounds -dp -qc[TOHALF]))
#CeTA does not support -dp -rfc -qc
BOUNDSDPTRS = (FULL(bounds -dp -rfc -qc || bounds -dp -all -rfc -qc || bounds -rfc -qc))
#CeTA does not support
CDG = (FULL(fail))? #cdg -rfc[0.5]?
#CeTA does not support
HYDRA = (FULL\
 ((emb -w;(eps0 -ib 1 -ob 2 -id 3 -od 4 -ws -d2 || eps0 -ib 1 -ob 2 -id 2 -od 3 -ws -d2)?; \
  (matrix -dim 2 -ib 2 -ob 2 -dp -d2 || matrix -ib 2 -ob 3 -dp -d2 -direct)*)! || \
 (dp;edg?;sccs?;(sc | eps0 -ib 1 -ob 2 -id 2 -od 3 -ws -rev; \
   matrix -dp -dim 1 -ib 2 -ob 2 -direct?;matrix -dp -dim 2 -ib 2 -ob 2 -direct!))))
#TTT2 does not give CeTA output
NLPOLY = (FULL(poly -nl -heuristic 1 -neg -ib 3 -ob 7 -direct[9]))
#TTT2 does not give CeTA output
REF = (FULL(ref))
#TTT2 does not give CeTA output
SLTRS = (FULL(\
 sl -dp -ur -dim 1 -ib 1 -ob 2 -pl || \
 sl -dp -ur -dim 1 -ib 2 -ob 2 -pl || \
 sl -dp -ur -dim 2 -ib 1 -ob 2 -pl || \
 fail))
#relative
BOUNDSRT = (FULL(if duplicating then fail else (bounds -rt || bounds -rt -qc)))

#TRS strategy
PRETRS = ((\
 matrix -dim 1 -ib 3 -ob 5 || \
 matrix -dim 2 -ib 2 -ob 3 || \
 matrix -dim 3 -ib 1 -ob 2 || \
 matrix -dim 3 -ib 1 -ob 1 || \
 fail)[PRETRSTO]*)
DIRECTTRS = ((\
 kbo || \
 (lpo | REF;lpo) || \
 fail)*[7])!
MATRIXDPTRS = (\
  matrix -dp -ur -dim 1 -ib 3 -ob 5 || \
  matrix -dp -ur -dim 1 -ib 3 -ob 8 -rat 2 -db 1 || \
  matrix -dp -ur -dim 1 -ib 4 -ob 10 -rat 4 -db 1 || \
  matrix -dp -ur -dim 2 -ib 2 -ob 3 || \
  matrix -dp -ur -dim 3 -ib 1 -ob 3 || \
  matrix -dp -ur -dim 3 -ib 2 -ob 3 || \
  matrix -dp -ur -dim 4 -ib 1 -ob 2 || \
  fail)
ARCTICDPTRS = \
(arctic -dp -ur -dim 1 -ib 4 -ob 3[1] | \
 arctic -dp -ur -dim 2 -ib 2 -ob 2[2] | \
 arctic -dp -ur -dim 3 -ib 1 -ob 1[2] | \
 arctic -dp -ur -dim 4 -ib 1 -ob 1[2] | \
 fail)
ARCTICBZDPTRS = \
(arctic -bz -dp -ur -dim 1 -ib 4 -ob 3[1] | \
 arctic -bz -dp -ur -dim 2 -ib 2 -ob 2[2] | \
 arctic -bz -dp -ur -dim 3 -ib 1 -ob 1[2] | \
 arctic -bz -dp -ur -dim 4 -ib 1 -ob 1[2] | \
 fail)
SC = (sc || sc -rec -defs || sc -mulex -defs)
UNCURRY = (uncurryx -appsym max -aarity max?;uncurryx -top -appsym max -aarity max)
MAINDPS = (tdg?;(sccs | sc)*;edg -gtcap -nl[1.0]?;CDG;((sccs | \
 (SC || sct || \
 {ur?;( \
  MATRIXDPTRS || \
  (kbo -ur -af | lpo -ur -af) || \
  ARCTICDPTRS || \
  ARCTICBZDPTRS || \
  (if duplicating then fail else SLTRS) || \
  fail) \
 }restore || \
 BOUNDSDPTRS || \
 fail \
 ))[SCCTOTRS] | \
 UNCURRY \
 )*[SCCTOXTRS])
MAINTRS = (dp;MAINDPS)
TOTALTRS=(PRETRS;(MAINTRS || DIRECTTRS || unfold))
TRS = ((\
 if applicative then \
  (lpo | uncurryx -appsym max -aarity max?;TOTALTRS) \
 else \
  TOTALTRS \
 )[TOTRS] || \
 NLPOLY || \
 fail)!


SN=(PRETRS;(MAINTRS || DIRECTTRS))

REV = rev?
MATRIXSRS = ( \
  matrix -dim 1 -ib 4 -ob 5[4] || \
  matrix -dim 2 -ib 2 -ob 3[4] || \
  matrix -dim 3 -ib 1 -ob 2[4] || \
  matrix -dim 3 -ib 2 -ob 3[4] || \
  matrix -dim 4 -ib 1 -ob 2[4] || \
  fail )
ARCTICSRS = ( \
  arctic -dim 1 -ib 4 -ob 5[4] || \
  arctic -dim 2 -ib 2 -ob 3[4] || \
  arctic -dim 3 -ib 1 -ob 2[4] || \
  arctic -dim 3 -ib 2 -ob 2[4] || \
  fail )
DIRECTSRS = ( \
  MATRIXSRS || \
  BOUNDS || \
  kbo || \
  unfold || \
  fail)
PRESRS = ((DIRECTSRS || REV;DIRECTSRS)[PRESRSTO])*
DPSRS = (\
 matrix -dim 1 -dp -ib 5 -ob 6[TOSRS] || \
 matrix -dim 1 -dp -ur -ib 4 -ob 10 -rat 2 -db 5[TOSRS] || \
 (kbo | kbo -af -ur | lpo -af -ur)[TOSRS] || \
 matrix -dp -dim 2 -ib 3 -ob 3[TOSRS] || \
 (matrix -dp -dim 3 -ib 1 -ob 2[TOHALF] | matrix -dp -dim 3 -ib 2 -ob 3)[TOSRS] || \
 matrix -dp -dim 4 -ib 1 -ob 1[TOSRS] || \
 matrix -dp -dim 5 -ib 1 -ob 2[TOSRS])

ARCTICDPSRS = (\
 arctic -dp -ur -dim 1 -ib 4 -ob 5[TOSRS] || \
 arctic -dp -ur -dim 2 -ib 2 -ob 3[TOSRS] || \
 arctic -dp -ur -dim 3 -ib 1 -ob 2[TOSRS] || \
 arctic -dp -ur -dim 4 -ib 1 -ob 1[TOSRS])
ARCTICBZDPSRS = (\
 arctic -bz -dp -ur -dim 1 -ib 4 -ob 5[TOSRS] || \
 arctic -bz -dp -ur -dim 2 -ib 2 -ob 3[TOSRS] || \
 arctic -bz -dp -ur -dim 3 -ib 1 -ob 2[TOSRS] || \
 arctic -bz -dp -ur -dim 4 -ib 1 -ob 1[TOSRS])
LOOPSDPSRS = (FULL(\
 loop -dp -r 15 -c 15[TOSXTH] | \
 loop -dp -r 20 -c 15[TOSXTH] | \
 loop -dp -r 15 -c 20[TOSXTH] | \
 loop -dp -r 20 -c 20[TOHALF]))
LABDPSRS = (((dp;(tdg?;(sccs | ur | poly -ib 1 -ob 2 | poly -dp -ur -ib 1 -ob 3)*;rlab)2*)[3]))!
MAINSRS = (dp;(tdg?;edg -gtcap[1.0]?;CDG;sccs?;({ur?;( \
 DPSRS || \
 BOUNDSDPSRS || \
 ARCTICBZDPSRS || \
 ARCTICDPSRS || \
 LOOPSDPSRS || \
 fail)}restore?)[SCCTOSRS])*)
SRS = ((PRESRS;(MAINSRS[TOSRS] || REV;MAINSRS[TOSRS])) || (sleep -t 10?;LABDPSRS))[TOSRS]

#
#
#certification
#tkbo -ib 3 -ob 4 -degree 0 -sb 2 || \
PRETRSCERT = ((\
 (if srs then arctic -dim 1 -ib 4 -ob 5 else fail) || \
 (if srs then arctic -dim 2 -ib 2 -ob 3 else fail) || \
 (if srs then arctic -dim 3 -ib 1 -ob 2 else fail) || \
 (if srs then arctic -dim 3 -ib 2 -ob 2 else fail) || \
 matrix -dim 1 -ib 5 -ob 8 || \
 matrix -dim 2 -ib 3 -ob 4 || \
 matrix -dim 3 -ib 2 -ob 3 || \
 matrix -dim 3 -ib 1 -ob 2 || \
 matrix -dim 4 -ib 1 -ob 2 || \
 matrix -dim 5 -ib 1 -ob 1 || \
 kbo -ib 3 -ob 4 || \
 fail)[5]*)
NSNTRSCERT = ((\
 unfold || \
 fail)*[7])!
ARCTICTRSCERT = \
(arctic -dp -ur -dim 1 -ib 4 -ob 3[TOSXTH] | \
 arctic -dp -ur -dim 2 -ib 2 -ob 2[TOFRTH] | \
 arctic -dp -ur -dim 3 -ib 1 -ob 1[TOFRTH] | \
 arctic -dp -ur -dim 4 -ib 1 -ob 1[TOFRTH] | \
 fail)
ARCTICBZTRSCERT = \
(arctic -bz -dp -ur -dim 1 -ib 4 -ob 3[TOSXTH] | \
 arctic -bz -dp -ur -dim 2 -ib 2 -ob 2[TOFRTH] | \
 arctic -bz -dp -ur -dim 3 -ib 1 -ob 1[TOFRTH] | \
 arctic -bz -dp -ur -dim 4 -ib 1 -ob 1[TOFRTH] | \
 fail)

MAINDPSCERT = (edg -gtcap -nl[1.0]?;(sccs | \
 (SC || sct || \
  {ur?;( \
   matrix -dp -ur -dim 1 -ib 3 -ob 5 || \
   matrix -dp -ur -dim 1 -ib 3 -ob 8 -rat 2 -db 1 || \
   matrix -dp -ur -dim 1 -ib 4 -ob 10 -rat 4 -db 1 || \
   matrix -dp -ur -dim 2 -ib 2 -ob 3 || \
   matrix -dp -ur -dim 2 -ib 3 -ob 4 -rat 2 -db 0 || \
   matrix -dp -ur -dim 3 -ib 1 -ob 3 || \
   matrix -dp -ur -dim 3 -ib 2 -ob 3 || \
   matrix -dp -ur -dim 3 -ib 2 -ob 3 -rat 2 -db 0 || \
   matrix -dp -ur -dim 4 -ib 1 -ob 2 || \
   lpo -ur -af || \
   ARCTICTRSCERT || \
   ARCTICBZTRSCERT || \
   fail) \
  } restore) \
 )*[SCCTOSRS])
MAINTRSCERT = (dp;MAINDPSCERT)
DIRECTTRSCERT=BOUNDS
SNTRSCERT=(PRETRSCERT;(MAINTRSCERT || DIRECTTRSCERT))!
TRSCERT = (SNTRSCERT || NSNTRSCERT)

#relative
PRERELATIVE = (\
 BOUNDSRT || \
 lpo -quasi || \
 matrix -dim 1 -ib 5 -ob 6 || \
 matrix -dim 2 -ib 4 -ob 5 || \
 matrix -dim 2 -ib 2 -ob 2 || \
 matrix -dim 3 -ib 3 -ob 4 || \
 matrix -dim 3 -ib 2 -ob 3 || \
 matrix -dim 4 -ib 2 -ob 3 || \
 matrix -dim 4 -ib 2 -ob 2 || \
 matrix -dim 5 -ib 2 -ob 2 || \
 matrix -dim 5 -ib 1 -ob 2 || \
 arctic -dim 1 -ib 4 -ob 5 || \
 arctic -dim 2 -ib 3 -ob 4 || \
 arctic -dim 3 -ib 2 -ob 3 || \
 arctic -dim 4 -ib 2 -ob 2 || \
 fail \
 )
SNRELATIVE = ((\
 PRERELATIVE || \
 REV;PRERELATIVE || \
 if srs then (sleep -t 5?;rlab) else fail || \
 fail \
)[7]*;(FULL(rt -inv -force;SN)!))[TO]
RELATIVE = ((\
 unfold || \
 REV;unfold || \
 SNRELATIVE))[TO]

#everything together
COMP = (if standard \
 then (var | con | (if srs then (SRS[TOSRS]) else (TRS[TOTRS] || sleep -t 10?;HYDRA[TOTRS]))) \
 else (if relative then RELATIVE else fail))[TO]

#cert
COMPCERT = ((if standard then var else fail) | con | (if srs \
 then ((sleep -t 25?;rlab;TRSCERT[TO])! || (TRSCERT[TO])! || (REV;SNTRSCERT[TO])! ) \
 else (TRSCERT[TO])))

